
package-lock.json
======

# npm install 规则变化

自`npm 5.0`版本发布以来，`npm i`的规则发生了三次变化:

1. npm `5.0.x` 版本，不管`package.json`怎么变，`npm i` 时都会根据lock文件下载

[package-lock.json file not updated after package.json file is changed](https://github.com/npm/npm/issues/16866) 控诉了这个问题，明明手动改了package.json，为何不给我升级包

然后就导致了5.1.0的问题...

2. `5.1.0`版本后 `npm install` 会无视`lock`文件, 去下载最新的npm 

[why is package-lock being ignored? #17979](https://github.com/npm/npm/issues/17979)

3. 最后演变成`5.4.2`版本后的规则。

大致意思是，如果改了`package.json`，且`package.json`和`lock`文件不同，那么执行`npm i`时npm会根据package中的版本号以及语义含义去下载最新的包，并更新至lock。


# 什么时候生成？

是当 node_modules 或 package.json 发生变化时自动生成的文件。这个文件主要功能是确定当前安装的包的依赖，以便后续重新安装的时候生成相同的依赖，而忽略项目开发过程中有些依赖已经发生的更新。

这个`package-lock.json` 是在 `npm install`时候生成一份文件，用以记录当前状态下实际安装的各个npm package的具体来源和版本号。

# 使用

它有什么用呢？因为npm是一个用于管理package之间依赖关系的管理器，它允许开发者在pacakge.json中间标出自己项目对npm各库包的依赖。你可以选择以如下方式来标明自己所需要库包的版本

``` json
"dependencies": {
  "@types/node": "^8.0.33"
}
```
这里面的 向上标号 ^ 是定义了向后（新）兼容依赖，指如果 types/node的版本是超过8.0.33，并在大版本号（8）上相同，就允许下载最新版本的 types/node库包，例如实际上可能运行npm install时候下载的具体版本是8.0.35。波浪号

大多数情况这种向新兼容依赖下载最新库包的时候都没有问题，可是因为npm是开源世界，各库包的版本语义可能并不相同，有的库包开发者并不遵守严格这一原则：相同大版本号的同一个库包，其接口符合兼容要求。这时候用户就很头疼了：在完全相同的一个nodejs的代码库，在不同时间或者不同npm下载源之下，下到的各依赖库包版本可能有所不同，因此其依赖库包行为特征也不同有时候甚至完全不兼容。

因此npm最新的版本就开始提供自动生成package-lock.json功能，为的是让开发者知道只要你保存了源文件，到一个新的机器上、或者新的下载源，只要按照这个package-lock.json所标示的具体版本下载依赖库包，就能确保所有库包与你上次安装的完全一样。


https://www.zhihu.com/question/62331583